@model dynamic

@{
    ViewData["Title"] = "Admin Dashboard";
    var activeTab = Context.Request.Query["activeTab"].FirstOrDefault() ?? "customers";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/DashboardStyle.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Admin Dashboard</h1>

    <!-- Navigation Tabs -->
    <ul class="nav nav-tabs" id="dashboardTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <a class="nav-link @(activeTab == "customers" ? "active" : "")" id="customers-tab" data-toggle="tab" href="#customers" role="tab" aria-controls="customers" aria-selected="@(activeTab == "customers")">Customers</a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link @(activeTab == "retailers" ? "active" : "")" id="retailers-tab" data-toggle="tab" href="#retailers" role="tab" aria-controls="retailers" aria-selected="@(activeTab == "retailers")">Retailers</a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link @(activeTab == "products" ? "active" : "")" id="products-tab" data-toggle="tab" href="#products" role="tab" aria-controls="products" aria-selected="@(activeTab == "products")">Products</a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link @(activeTab == "categories" ? "active" : "")" id="categories-tab" data-toggle="tab" href="#categories" role="tab" aria-controls="categories" aria-selected="@(activeTab == "categories")">Categories</a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link @(activeTab == "orders" ? "active" : "")" id="orders-tab" data-toggle="tab" href="#orders" role="tab" aria-controls="orders" aria-selected="@(activeTab == "orders")">Orders</a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link @(activeTab == "reviews" ? "active" : "")" id="reviews-tab" data-toggle="tab" href="#reviews" role="tab" aria-controls="reviews" aria-selected="@(activeTab == "reviews")">Reviews</a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link @(activeTab == "analytics" ? "active" : "")" id="analytics-tab" data-toggle="tab" href="#analytics" role="tab" aria-controls="analytics" aria-selected="@(activeTab == "analytics")">Analytics</a>
        </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content mt-4" id="dashboardContent">
        <!-- Customers Section -->
        <div class="tab-pane fade @(activeTab == "customers" ? "show active" : "")" id="customers" role="tabpanel" aria-labelledby="customers-tab">
            <h2>Customers</h2>
            <div class="table-responsive">
                <!-- Add this div for responsiveness -->
                <table class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th>First Name</th>
                            <th>Last Name</th>
                            <th>Email</th>
                            <th>Phone Number</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var customer in Model.Customers)
                        {
                            <tr>
                                <td>@customer.FirstName</td>
                                <td>@customer.LastName</td>
                                <td>@customer.Email</td>
                                <td>@customer.PhoneNumber</td>
                                <td>
                                    <a asp-controller="Admin" asp-action="EditUser" asp-route-id="@customer.CustomerID" class="btn btn-warning">Edit</a>
                                    <form asp-controller="Admin" asp-action="DeleteUser" asp-route-id="@customer.CustomerID" method="post" style="display:inline;">
                                        <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this customer?');">Delete</button>
                                    </form>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>


    <!-- Retailers Section -->
    <div class="tab-pane fade @(activeTab == "retailers" ? "show active" : "")" id="retailers" role="tabpanel" aria-labelledby="retailers-tab">
        <h2>Retailers</h2>
        <div class="table-responsive">
            <!-- Responsive container -->
            <table class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th>Farm Name</th>
                        <th>Owner Name</th>
                        <th>Email</th>
                        <th>Phone Number</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var retailer in Model.Retailers)
                    {
                        <tr>
                            <td>@retailer.FarmName</td>
                            <td>@retailer.FirstName @retailer.LastName</td>
                            <td>@retailer.Email</td>
                            <td>@retailer.PhoneNumber</td>
                            <td>
                                <a asp-controller="Admin" asp-action="EditRetailer" asp-route-id="@retailer.RetailerID" class="btn btn-warning">Edit</a>
                                <form asp-controller="Admin" asp-action="DeleteRetailer" asp-route-id="@retailer.RetailerID" method="post" style="display:inline;">
                                    <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this retailer?');">Delete</button>
                                </form>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

        <!-- Products Section -->
        <div class="tab-pane fade @(activeTab == "products" ? "show active" : "")" id="products" role="tabpanel" aria-labelledby="products-tab">
            <h2>Products</h2>
            <div class="table-responsive">
                <!-- Responsive container -->
                <table class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th>Product</th> <!-- Changed from Product Name to Product -->
                            <th>Price</th>
                            <th>Stock Quantity</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var product in Model.Products)
                        {
                            <tr>
                                <td>
                                    <!-- Display product image beside the name -->
                                    <img src="@product.ImageUrl" alt="Product Image" style="width: 50px; height: 50px; margin-right: 10px;" />
                                    @product.ProductName
                                </td>
                                <td>₹ @product.Price.ToString("0.00")</td> <!-- Added rupee sign and formatted price -->
                                <td>@product.StockQuantity</td>
                                <td>
                                    <a asp-controller="Admin" asp-action="EditProduct" asp-route-id="@product.ProductID" class="btn btn-warning">Edit</a>
                                    <form asp-controller="Admin" asp-action="DeleteProduct" asp-route-id="@product.ProductID" method="post" style="display:inline;">
                                        <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this product?');">Delete</button>
                                    </form>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>

    <!-- Categories Section -->
    <div class="tab-pane fade @(activeTab == "categories" ? "show active" : "")" id="categories" role="tabpanel" aria-labelledby="categories-tab">
        <h2>Categories</h2>
        <a asp-controller="Admin" asp-action="CreateCategory" class="btn btn-primary mb-2">Add New Category</a>
        <div class="table-responsive">
            <!-- Responsive container -->
            <table class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th>Category Name</th>
                        <th>Description</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var category in Model.Categories)
                    {
                        <tr>
                            <td>@category.CategoryName</td>
                            <td>@category.Description</td>
                            <td>
                                <a asp-controller="Admin" asp-action="EditCategory" asp-route-id="@category.CategoryID" class="btn btn-warning">Edit</a>
                                <form asp-controller="Admin" asp-action="DeleteCategory" asp-route-id="@category.CategoryID" method="post" style="display:inline;">
                                    <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this category?');">Delete</button>
                                </form>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

    <!-- Orders Section -->
    <div class="tab-pane fade @(activeTab == "orders" ? "show active" : "")" id="orders" role="tabpanel" aria-labelledby="orders-tab">
        <h2>Orders</h2>
        <div class="table-responsive">
            <!-- Responsive container -->
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Order ID</th>
                        <th>Product Name</th>
                        @* <th>Product ID</th> *@
                        <th>Customer ID</th>
                        <th>Customer Name</th>
                        <th>Order Date</th>
                        <th>Total Amount</th>
                        <th>Shipping Address</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var order in Model.Orders)
                    {
                        foreach (var orderItem in order.OrderItem)
                        {
                            <tr>
                                <td>@order.OrderID</td>
                                <td>@orderItem.Product.ProductName</td>
                                @* <td>@orderItem.ProductID</td> *@
                                <td>@order.Customer.CustomerID</td>
                                <td>@order.Customer.FirstName @order.Customer.LastName</td>
                                <td>@order.OrderDate.ToString("yyyy-MM-dd")</td>
                                <td>@order.TotalAmount</td>
                                <td>@order.ShippingAddress</td>
                                <td>@order.Status</td>
                                <td>
                                    <a asp-controller="Admin" asp-action="EditOrder" asp-route-id="@order.OrderID" class="btn btn-warning btn-sm">Edit</a>
                                    <form asp-controller="Admin" asp-action="DeleteOrder" asp-route-id="@order.OrderID" method="post" style="display:inline;">
                                        <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this order?');">Delete</button>
                                    </form>
                                </td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>
    </div>

    <!-- Reviews Section -->
    <div class="tab-pane fade @(activeTab == "reviews" ? "show active" : "")" id="reviews" role="tabpanel" aria-labelledby="reviews-tab">
        <h2>Reviews</h2>
        <div class="table-responsive">
            <!-- Responsive container -->
            <table class="table">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Customer</th>
                        <th>Rating</th>
                        <th>Comment</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var review in Model.Reviews)
                    {
                        <tr>
                            <td>@review.Product.ProductName</td>
                            <td>@review.Customer.FirstName @review.Customer.LastName</td>
                            <td>@review.Rating</td>
                            <td>@review.Comment</td>
                            <td>
                                @if (!review.Approved)
                                {
                                    <form asp-controller="Admin" asp-action="ApproveReview" asp-route-id="@review.ReviewID" method="post" style="display:inline;">
                                        <button type="submit" class="btn btn-success btn-sm">Approve</button> <!-- Added btn-sm for smaller buttons -->
                                    </form>
                                }
                                <form asp-controller="Admin" asp-action="DeleteReview" asp-route-id="@review.ReviewID" method="post" style="display:inline;">
                                    <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this review?');">Delete</button> <!-- Added btn-sm for smaller buttons -->
                                </form>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

    <!-- Analytics Section -->
    <div class="tab-pane fade @(activeTab == "analytics" ? "show active" : "")" id="analytics" role="tabpanel" aria-labelledby="analytics-tab">
        <h2>Analytics</h2>
            <!-- Statistics Cards -->
            <div class="row mb-4">
                <div class="col-md-4">
                    <div class="card text-center">
                        <div class="card-body">
                            <h5 class="card-title">Total Retailers</h5>
                            <p class="card-text">@Model.TotalRetailers</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card text-center">
                        <div class="card-body">
                            <h5 class="card-title">Total Customers</h5>
                            <p class="card-text">@Model.TotalCustomers</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card text-center">
                        <div class="card-body">
                            <h5 class="card-title">Total Products</h5>
                            <p class="card-text">@Model.TotalProducts</p>
                        </div>
                    </div>
                </div>
            </div>
        <div class="chart-container">
            <!-- Responsive container for charts -->
            <canvas id="productChart"></canvas>
            <canvas id="salesChart"></canvas>
        </div>

        <script>
            // Function to generate random RGBA color
            function getRandomColor() {
                const r = Math.floor(Math.random() * 255);
                const g = Math.floor(Math.random() * 255);
                const b = Math.floor(Math.random() * 255);
                return `rgba(${r}, ${g}, ${b}, 0.8)`; // Adjust transparency if needed
            }

            // Prepare color arrays based on the number of products
            const productCount = @Html.Raw(Model.ProductLabels.Count);
            const backgroundColors = [];
            const borderColors = [];

            for (let i = 0; i < productCount; i++) {
                const randomColor = getRandomColor();
                backgroundColors.push(randomColor);
                borderColors.push(randomColor.replace('0.8', '1')); // Replace transparency for border
            }

            const productData = {
                labels: @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.ProductLabels)),
                datasets: [{
                    label: 'Product Quantity',
                    data: @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.ProductQuantities)),
                    backgroundColor: backgroundColors,
                    borderColor: borderColors,
                    borderWidth: 1
                }]
            };

            const salesData = {
                labels: @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.SalesLabels)),
                datasets: [{
                     label: 'Daily Sales',
                     data: @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.DailySales)),
                     backgroundColor: 'rgba(255, 206, 86, 0.8)', // Fixed color for sales chart
                     borderColor: 'rgba(255, 206, 86, 1)',
                     borderWidth: 1
                }]
            };


            const productConfig = {
                type: 'bar',
                data: productData,
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            };

            const salesConfig = {
                type: 'line',
                data: salesData,
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            };

            new Chart(document.getElementById('productChart'), productConfig);
            new Chart(document.getElementById('salesChart'), salesConfig);
        </script>
    </div>
</div>


    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.6.0/js/bootstrap.min.js"></script>

    <!-- Optional JavaScript to handle tab switching if necessary -->
    <script>
        $(document).ready(function () {
            // Activate the tab on click
            $('#dashboardTabs a').on('click', function (e) {
                e.preventDefault();
                $(this).tab('show'); // Show the clicked tab
            });

            // Activate the correct tab on page load based on the activeTab variable
            const activeTab = '@activeTab';
            if (activeTab) {
                $('#dashboardTabs a[href="#' + activeTab + '"]').tab('show');
            }
        });
    </script>

</body>
</html>