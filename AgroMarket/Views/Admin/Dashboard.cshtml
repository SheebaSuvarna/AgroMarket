@model dynamic

@{
    ViewData["Title"] = "Admin Dashboard";

    // Get the active tab from the query parameter (default to "customers")
    var activeTab = Context.Request.Query["activeTab"].FirstOrDefault() ?? "customers"; // Using Context.Request
                                                                                        // or use: var activeTab = HttpContext.Request.Query["activeTab"].FirstOrDefault() ?? "customers";
}

<head>
    <link rel="stylesheet" href="~/css/DashboardStyle.css" />
</head>

<h1>Admin Dashboard</h1>

<!-- Navigation Tabs -->
<ul class="nav nav-tabs" id="dashboardTabs" role="tablist">
    <li class="nav-item" role="presentation">
        <a class="nav-link @(activeTab == "customers" ? "active" : "")" id="customers-tab" data-toggle="tab" href="#customers" role="tab" aria-controls="customers" aria-selected="@(activeTab == "customers")">Customers</a>
    </li>
    <li class="nav-item" role="presentation">
        <a class="nav-link @(activeTab == "retailers" ? "active" : "")" id="retailers-tab" data-toggle="tab" href="#retailers" role="tab" aria-controls="retailers" aria-selected="@(activeTab == "retailers")">Retailers</a>
    </li>
    <li class="nav-item" role="presentation">
        <a class="nav-link @(activeTab == "products" ? "active" : "")" id="products-tab" data-toggle="tab" href="#products" role="tab" aria-controls="products" aria-selected="@(activeTab == "products")">Products</a>
    </li>
    <li class="nav-item" role="presentation">
        <a class="nav-link @(activeTab == "reviews" ? "active" : "")" id="reviews-tab" data-toggle="tab" href="#reviews" role="tab" aria-controls="reviews" aria-selected="@(activeTab == "reviews")">Reviews</a>
    </li>
    <li class="nav-item" role="presentation">
        <a class="nav-link @(activeTab == "categories" ? "active" : "")" id="categories-tab" data-toggle="tab" href="#categories" role="tab" aria-controls="categories" aria-selected="@(activeTab == "categories")">Categories</a>
    </li>
</ul>

<!-- Tab Content -->
<div class="tab-content mt-4" id="dashboardContent">
    <!-- Customers Section -->
    <div class="tab-pane fade @(activeTab == "customers" ? "show active" : "")" id="customers" role="tabpanel" aria-labelledby="customers-tab">
        <h2>Customers</h2>
        <table class="table">
            <thead>
                <tr>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Email</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var customer in Model.Customers)
                {
                    <tr>
                        <td>@customer.FirstName</td>
                        <td>@customer.LastName</td>
                        <td>@customer.Email</td>
                        <td>
                            <a asp-controller="Admin" asp-action="EditUser" asp-route-id="@customer.CustomerID" class="btn btn-warning">Edit</a>
                            <form asp-controller="Admin" asp-action="DeleteUser" asp-route-id="@customer.CustomerID" method="post" style="display:inline;">
                                <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this customer?');">Delete</button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- Retailers Section -->
    <div class="tab-pane fade @(activeTab == "retailers" ? "show active" : "")" id="retailers" role="tabpanel" aria-labelledby="retailers-tab">
        <h2>Retailers</h2>
        <table class="table">
            <thead>
                <tr>
                    <th>Farm Name</th>
                    <th>Owner Name</th>
                    <th>Email</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var retailer in Model.Retailers)
                {
                    <tr>
                        <td>@retailer.FarmName</td>
                        <td>@retailer.FirstName @retailer.LastName</td>
                        <td>@retailer.Email</td>
                        <td>
                            <a asp-controller="Admin" asp-action="EditRetailer" asp-route-id="@retailer.RetailerID" class="btn btn-warning">Edit</a>
                            <form asp-controller="Admin" asp-action="DeleteRetailer" asp-route-id="@retailer.RetailerID" method="post" style="display:inline;">
                                <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this retailer?');">Delete</button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- Products Section -->
    <div class="tab-pane fade @(activeTab == "products" ? "show active" : "")" id="products" role="tabpanel" aria-labelledby="products-tab">
        <h2>Products</h2>
        <table class="table">
            <thead>
                <tr>
                    <th>Product Name</th>
                    <th>Price</th>
                    <th>Stock Quantity</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var product in Model.Products)
                {
                    <tr>
                        <td>@product.ProductName</td>
                        <td>@product.Price</td>
                        <td>@product.StockQuantity</td>
                        <td>
                            <a asp-controller="Admin" asp-action="EditProduct" asp-route-id="@product.ProductID" class="btn btn-warning">Edit</a>
                            <form asp-controller="Admin" asp-action="DeleteProduct" asp-route-id="@product.ProductID" method="post" style="display:inline;">
                                <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this product?');">Delete</button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- Categories Section -->
    <div class="tab-pane fade @(activeTab == "categories" ? "show active" : "")" id="categories" role="tabpanel" aria-labelledby="categories-tab">
        <h2>Categories</h2>
        <a asp-controller="Admin" asp-action="CreateCategory" class="btn btn-primary mb-2">Add New Category</a>
        <table class="table">
            <thead>
                <tr>
                    <th>Category Name</th>
                    <th>Description</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var category in Model.Categories)
                {
                    <tr>
                        <td>@category.CategoryName</td>
                        <td>@category.Description</td>
                        <td>
                            <a asp-controller="Admin" asp-action="EditCategory" asp-route-id="@category.CategoryID" class="btn btn-warning">Edit</a>
                            <form asp-controller="Admin" asp-action="DeleteCategory" asp-route-id="@category.CategoryID" method="post" style="display:inline;">
                                <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this category?');">Delete</button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- Reviews Section -->
    <div class="tab-pane fade @(activeTab == "reviews" ? "show active" : "")" id="reviews" role="tabpanel" aria-labelledby="reviews-tab">
        <h2>Reviews</h2>
        <table class="table">
            <thead>
                <tr>
                    <th>Product</th>
                    <th>Customer</th>
                    <th>Rating</th>
                    <th>Comment</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var review in Model.Reviews)
                {
                    <tr>
                        <td>@review.Product.ProductName</td>
                        <td>@review.Customer.FirstName @review.Customer.LastName</td>
                        <td>@review.Rating</td>
                        <td>@review.Comment</td>
                        <td>
                            @if (!review.Approved)
                            {
                                <form asp-controller="Admin" asp-action="ApproveReview" asp-route-id="@review.ReviewID" method="post" style="display:inline;">
                                    <button type="submit" class="btn btn-success">Approve</button>
                                </form>
                            }
                            <form asp-controller="Admin" asp-action="DeleteReview" asp-route-id="@review.ReviewID" method="post" style="display:inline;">
                                <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this review?');">Delete</button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.6.0/js/bootstrap.min.js"></script>

<!-- Optional JavaScript to handle tab switching if necessary -->
<script>
    $(document).ready(function () {
        $('#dashboardTabs a').on('click', function (e) {
            e.preventDefault();
            $(this).tab('show');
        });
    });
</script>
